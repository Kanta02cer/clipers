<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>統合YouTube動画分析システム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .api-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .api-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .status-section {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .status-section.show {
            display: block;
        }

        .status-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .status-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }

        .results-section {
            margin-top: 30px;
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .result-card {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .result-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .score-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .score-label {
            color: #666;
            margin-top: 5px;
        }

        .server-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
        }

        .server-online {
            background: #28a745;
            color: white;
        }

        .server-offline {
            background: #dc3545;
            color: white;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .feature-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .download-section {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .download-link {
            display: inline-block;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
        }

        .download-link:hover {
            background: #218838;
        }

        .clip-points-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .clip-point-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
        }

        .clip-time {
            font-size: 1.2em;
            font-weight: bold;
            color: #856404;
            margin-bottom: 5px;
        }

        .emotion-chart {
            display: flex;
            align-items: end;
            height: 100px;
            gap: 10px;
            margin: 20px 0;
        }

        .emotion-bar {
            flex: 1;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 5px 5px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            min-height: 20px;
        }

        .emotion-label {
            text-align: center;
            margin-top: 5px;
            font-size: 0.9em;
            color: #666;
        }

        .timestamp-comments {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .timestamp-comment {
            border-left: 3px solid #667eea;
            padding-left: 10px;
            margin: 10px 0;
        }

        .timestamp-time {
            font-weight: bold;
            color: #667eea;
        }

        .header-features {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .feature-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .gemini-thoughts {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .thought-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 4px solid #fff;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .current-step {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .processing-visualization {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .step-indicator {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
        }

        .step-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            animation: pulse 2s infinite;
        }

        .step-completed {
            background: #28a745;
            color: white;
        }

        .step-pending {
            background: #e9ecef;
            color: #6c757d;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .step-text {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .step-description {
            font-size: 14px;
            color: #666;
        }

        .real-time-log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .log-timestamp {
            color: #888;
            margin-right: 10px;
        }

        .log-message {
            color: #00ff00;
        }

        .transcription-text {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .analysis-details, .speech-patterns, .overall-assessment {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .analysis-details h4, .speech-patterns h4, .overall-assessment h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .analysis-details h5, .speech-patterns h5, .overall-assessment h5 {
            color: #495057;
            margin: 15px 0 8px 0;
        }

        .analysis-details ul, .speech-patterns ul, .overall-assessment ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .analysis-details li, .speech-patterns li, .overall-assessment li {
            margin: 5px 0;
            color: #495057;
        }

        .api-key-container {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 5px;
        }

        .save-key-btn, .load-key-btn, .clear-key-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-key-btn {
            background: #28a745;
            color: white;
        }

        .save-key-btn:hover {
            background: #218838;
        }

        .load-key-btn {
            background: #007bff;
            color: white;
        }

        .load-key-btn:hover {
            background: #0056b3;
        }

        .clear-key-btn {
            background: #dc3545;
            color: white;
        }

        .clear-key-btn:hover {
            background: #c82333;
        }

        .api-key-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }

        .api-key-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .api-key-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .api-key-status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .header-features {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .feature-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .modern-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid #e9ecef;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .modern-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }

        .modern-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .score-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .score-card:hover::before {
            transform: translateX(100%);
        }

        .score-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .score-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .clip-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .clip-card {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #fdcb6e;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .clip-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

        .clip-time {
            font-size: 1.3em;
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .emotion-visualization {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }

        .emotion-bars {
            display: flex;
            align-items: end;
            height: 120px;
            gap: 15px;
            margin: 20px 0;
        }

        .emotion-bar {
            flex: 1;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            min-height: 20px;
            position: relative;
            overflow: hidden;
        }

        .emotion-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.8s;
        }

        .emotion-bar:hover::after {
            transform: translateX(100%);
        }

        .progress-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .progress-bar-modern {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill-modern {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill-modern::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .floating-action-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-action-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }

        .notification.info {
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
        }
    </style>
</head>
<body>
    <div class="server-status" id="serverStatus">
        サーバー状態確認中...
    </div>

    <div class="container">
        <div class="header">
            <h1>🎬 AI YouTube Analysis Pro</h1>
            <p>Gemini AI搭載・統合YouTube動画分析システム</p>
            <div class="header-features">
                <span class="feature-tag">🤖 Gemini AI</span>
                <span class="feature-tag">✂️ 切り抜き分析</span>
                <span class="feature-tag">💭 感情分析</span>
                <span class="feature-tag">📊 VVPスコア</span>
            </div>
        </div>

        <div class="main-content">
            <div class="api-section">
                <h2>🔑 APIキー設定</h2>
                <div class="input-group">
                    <label for="youtubeApiKey">YouTube Data API v3 キー</label>
                    <div class="api-key-container">
                        <input type="password" id="youtubeApiKey" placeholder="YouTube APIキーを入力してください">
                        <button type="button" class="save-key-btn" onclick="saveApiKey('youtube')">💾 保存</button>
                        <button type="button" class="load-key-btn" onclick="loadApiKey('youtube')">📂 読み込み</button>
                        <button type="button" class="clear-key-btn" onclick="clearApiKey('youtube')">🗑️ 削除</button>
                    </div>
                </div>
                <div class="input-group">
                    <label for="geminiApiKey">Google Gemini API キー</label>
                    <div class="api-key-container">
                        <input type="password" id="geminiApiKey" placeholder="Gemini APIキーを入力してください">
                        <button type="button" class="save-key-btn" onclick="saveApiKey('gemini')">💾 保存</button>
                        <button type="button" class="load-key-btn" onclick="loadApiKey('gemini')">📂 読み込み</button>
                        <button type="button" class="clear-key-btn" onclick="clearApiKey('gemini')">🗑️ 削除</button>
                    </div>
                </div>
                <div class="api-key-status" id="apiKeyStatus"></div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="saveAllApiKeys()">💾 全APIキー保存</button>
                    <button class="btn btn-secondary" onclick="loadAllApiKeys()">📂 全APIキー読み込み</button>
                    <button class="btn btn-secondary" onclick="clearAllApiKeys()">🗑️ 全APIキー削除</button>
                </div>
            </div>

            <div class="api-section">
                <h2>🎬 動画分析設定</h2>
                <div class="input-group">
                    <label for="videoUrl">YouTube動画URL</label>
                    <input type="url" id="videoUrl" placeholder="https://www.youtube.com/watch?v=...">
                </div>
                <div class="input-group">
                    <label for="analysisType">分析タイプ</label>
                    <select id="analysisType">
                        <option value="comprehensive">統合分析（推奨）</option>
                        <option value="async">非同期分析（長時間動画用）</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="downloadVideo">動画ダウンロード</label>
                    <select id="downloadVideo">
                        <option value="true">有効</option>
                        <option value="false">無効（情報のみ）</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="outputFormat">出力形式</label>
                    <select id="outputFormat">
                        <option value="mp4">MP4</option>
                        <option value="mov">MOV</option>
                        <option value="avi">AVI</option>
                        <option value="mkv">MKV</option>
                    </select>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="startAnalysis()">🚀 分析開始</button>
                <button class="btn btn-secondary" onclick="checkServerStatus()">🔍 サーバー状態確認</button>
                <button class="btn btn-success" onclick="loadTestData()">📋 テストデータ読み込み</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>分析中です...しばらくお待ちください</p>
            </div>

            <div class="processing-visualization" id="processingVisualization" style="display: none;">
                <h3>🤖 Gemini AI リアルタイム処理状況</h3>
                
                <div class="current-step" id="currentStep">
                    初期化中...
                </div>

                <div class="gemini-thoughts" id="geminiThoughts">
                    <h4>🧠 Gemini AI 思考プロセス</h4>
                    <div id="thoughtsContainer">
                        <!-- 思考プロセスがここに表示されます -->
                    </div>
                </div>

                <div class="real-time-log" id="realTimeLog">
                    <h4>📊 リアルタイムログ</h4>
                    <div id="logContainer">
                        <!-- ログがここに表示されます -->
                    </div>
                </div>

                <div class="step-indicators" id="stepIndicators">
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step1">1</div>
                        <div class="step-text">
                            <div class="step-title">YouTube情報取得</div>
                            <div class="step-description">動画の詳細情報を取得</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step2">2</div>
                        <div class="step-text">
                            <div class="step-title">動画ダウンロード</div>
                            <div class="step-description">ファイルと字幕を取得</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step3">3</div>
                        <div class="step-text">
                            <div class="step-title">Gemini AI分析</div>
                            <div class="step-description">質的分析を実行</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step4">4</div>
                        <div class="step-text">
                            <div class="step-title">感情分析</div>
                            <div class="step-description">コメントの感情を分析</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step5">5</div>
                        <div class="step-text">
                            <div class="step-title">切り抜き分析</div>
                            <div class="step-description">切り抜きポイントを特定</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step6">6</div>
                        <div class="step-text">
                            <div class="step-title">結果統合</div>
                            <div class="step-description">最終レポートを作成</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="status-section" id="statusSection"></div>

            <div class="results-section" id="resultsSection">
                <h2>📊 分析結果</h2>
                
                <div class="result-card">
                    <h3>🎬 動画情報</h3>
                    <div id="videoInfo"></div>
                </div>

                <div class="result-card">
                    <h3>🤖 AI分析結果</h3>
                    <div class="score-grid" id="scoreGrid"></div>
                </div>

                <div class="result-card">
                    <h3>💎 Golden Clip</h3>
                    <div id="goldenClip"></div>
                </div>

                <div class="result-card">
                    <h3>✂️ 切り抜きポイント分析</h3>
                    <div id="clipAnalysis"></div>
                </div>

                <div class="result-card">
                    <h3>💭 感情分析</h3>
                    <div id="emotionAnalysis"></div>
                </div>

                <div class="result-card">
                    <h3>📋 Executive Summary</h3>
                    <div id="executiveSummary"></div>
                </div>

                <div class="result-card">
                    <h3>📥 ダウンロード情報</h3>
                    <div id="downloadInfo"></div>
                </div>

                <div class="result-card">
                    <h3>🎵 コンテンツ品質分析</h3>
                    <div id="contentAnalysis"></div>
                </div>

                <div class="result-card">
                    <h3>💬 コメント分析</h3>
                    <div id="commentsAnalysis"></div>
                </div>

                <div class="result-card">
                    <h3>📈 チャンネル情報</h3>
                    <div id="channelInfo"></div>
                </div>
            </div>

            <div class="feature-list">
                <div class="feature-item">
                    <div class="feature-icon">🎬</div>
                    <h3>動画取得</h3>
                    <p>YouTube Data API v3による詳細情報取得</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">⬇️</div>
                    <h3>動画ダウンロード</h3>
                    <p>yt-dlpによる高品質動画ファイル取得</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">🤖</div>
                    <h3>AI分析</h3>
                    <p>Gemini AIによる質的分析と評価</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">✂️</div>
                    <h3>切り抜き分析</h3>
                    <p>タイムスタンプ付きコメントによる切り抜きポイント特定</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">💭</div>
                    <h3>感情分析</h3>
                    <p>コメントの感情傾向と満足度分析</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">📊</div>
                    <h3>VVPスコア</h3>
                    <p>動画価値評価スコア（100点満点）</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';
        let currentTaskId = null;
        let statusCheckInterval = null;
        let geminiThoughts = [];
        let processingLog = [];

        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            loadApiKeys();
            checkServerStatus();
            setInterval(checkServerStatus, 30000); // 30秒ごとにサーバー状態確認
        });

        // APIキーの保存
        function saveApiKeys() {
            const youtubeKey = document.getElementById('youtubeApiKey').value;
            const geminiKey = document.getElementById('geminiApiKey').value;
            
            localStorage.setItem('youtubeApiKey', youtubeKey);
            localStorage.setItem('geminiApiKey', geminiKey);
            
            showStatus('APIキーを保存しました', 'success');
        }

        // APIキーの読み込み
        function loadApiKeys() {
            const youtubeKey = localStorage.getItem('youtubeApiKey');
            const geminiKey = localStorage.getItem('geminiApiKey');
            
            if (youtubeKey) document.getElementById('youtubeApiKey').value = youtubeKey;
            if (geminiKey) document.getElementById('geminiApiKey').value = geminiKey;
        }

        // テストデータの読み込み
        function loadTestData() {
            document.getElementById('youtubeApiKey').value = 'AIzaSyAs5sjHDdfbe8LZPUULNF2QrzAp-cD8lbg';
            document.getElementById('geminiApiKey').value = 'AIzaSyDosn3ybHfEAV66TsG1fVlTfNQ-itHSFAI';
            document.getElementById('videoUrl').value = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
            showStatus('テストデータを読み込みました', 'success');
        }

        // サーバー状態確認
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    timeout: 5000
                });
                
                const data = await response.json();
                
                const statusElement = document.getElementById('serverStatus');
                if (response.ok) {
                    statusElement.textContent = `🟢 サーバーオンライン (v${data.version})`;
                    statusElement.className = 'server-status server-online';
                } else {
                    throw new Error(`サーバーエラー: ${response.status}`);
                }
            } catch (error) {
                console.error('サーバー状態確認エラー:', error);
                const statusElement = document.getElementById('serverStatus');
                statusElement.textContent = '🔴 サーバーオフライン';
                statusElement.className = 'server-status server-offline';
                
                // エラー詳細を表示
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showStatus('サーバーに接続できません。バックエンドサーバーが起動しているか確認してください。', 'error');
                }
            }
        }

        // 分析開始
        async function startAnalysis() {
            const url = document.getElementById('videoUrl').value;
            const youtubeKey = document.getElementById('youtubeApiKey').value;
            const geminiKey = document.getElementById('geminiApiKey').value;
            const analysisType = document.getElementById('analysisType').value;
            const downloadVideo = document.getElementById('downloadVideo').value === 'true';
            const outputFormat = document.getElementById('outputFormat').value;

            if (!url || !youtubeKey || !geminiKey) {
                showStatus('URLとAPIキーを入力してください', 'error');
                return;
            }

            if (!url.includes('youtube.com') && !url.includes('youtu.be')) {
                showStatus('有効なYouTube URLを入力してください', 'error');
                return;
            }

            showLoading(true);
            hideResults();

            const requestData = {
                url: url,
                youtube_api_key: youtubeKey,
                gemini_api_key: geminiKey,
                download_video: downloadVideo,
                output_format: outputFormat
            };

            try {
                if (analysisType === 'async') {
                    await startAsyncAnalysis(requestData);
                } else {
                    await startSyncAnalysis(requestData);
                }
            } catch (error) {
                showStatus(`分析エラー: ${error.message}`, 'error');
                showLoading(false);
            }
        }

        // 同期分析
        async function startSyncAnalysis(requestData) {
            try {
                const response = await fetch(`${API_BASE_URL}/analyze-video`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                
                if (result.success) {
                    displayResults(result.data);
                    showStatus(`分析完了！処理時間: ${result.processing_time.toFixed(2)}秒`, 'success');
                } else {
                    showStatus(`分析失敗: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('API呼び出しエラー詳細:', error);
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error(`サーバーに接続できません。サーバーが起動しているか確認してください。`);
                } else if (error.message.includes('404')) {
                    throw new Error(`APIエンドポイントが見つかりません。サーバーの設定を確認してください。`);
                } else {
                    throw new Error(`API呼び出しエラー: ${error.message}`);
                }
            } finally {
                showLoading(false);
            }
        }

        // 非同期分析
        async function startAsyncAnalysis(requestData) {
            try {
                const response = await fetch(`${API_BASE_URL}/analyze-video-async`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                
                if (result.task_id) {
                    currentTaskId = result.task_id;
                    showStatus('非同期分析を開始しました。進捗を確認中...', 'info');
                    
                    // リアルタイム処理状況表示を開始
                    showProcessingVisualization();
                    resetProcessingState();
                    
                    startStatusCheck();
                } else {
                    throw new Error('タスクIDが取得できませんでした');
                }
            } catch (error) {
                throw new Error(`非同期分析開始エラー: ${error.message}`);
            }
        }

        // 状態確認
        function startStatusCheck() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
            }
            
            statusCheckInterval = setInterval(async () => {
                if (!currentTaskId) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/analysis-status/${currentTaskId}`);
                    const status = await response.json();
                    
                    updateProgress(status.progress);
                    updateProcessingVisualization(status);
                    
                    if (status.status === 'completed') {
                        clearInterval(statusCheckInterval);
                        displayResults(status.result);
                        showStatus('非同期分析完了！', 'success');
                        showLoading(false);
                        hideProcessingVisualization();
                        currentTaskId = null;
                    } else if (status.status === 'error') {
                        clearInterval(statusCheckInterval);
                        showStatus(`非同期分析エラー: ${status.error}`, 'error');
                        showLoading(false);
                        hideProcessingVisualization();
                        currentTaskId = null;
                    }
                } catch (error) {
                    console.error('状態確認エラー:', error);
                }
            }, 2000); // 2秒ごとに確認
        }

        // 進捗更新
        function updateProgress(progress) {
            const progressBar = document.querySelector('.progress-fill');
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
            }
        }

        // 結果表示
        function displayResults(data) {
            if (!data) return;

            // 動画情報
            const videoInfo = data.video_info;
            if (videoInfo) {
                document.getElementById('videoInfo').innerHTML = `
                    <p><strong>タイトル:</strong> ${videoInfo.title}</p>
                    <p><strong>チャンネル:</strong> ${videoInfo.channel_title}</p>
                    <p><strong>再生回数:</strong> ${videoInfo.view_count.toLocaleString()}</p>
                    <p><strong>高評価数:</strong> ${videoInfo.like_count.toLocaleString()}</p>
                    <p><strong>コメント数:</strong> ${videoInfo.comment_count.toLocaleString()}</p>
                    <p><strong>公開日:</strong> ${new Date(videoInfo.published_at).toLocaleDateString('ja-JP')}</p>
                `;
            }

            // AI分析結果
            const geminiAnalysis = data.gemini_analysis;
            if (geminiAnalysis) {
                const scoreGrid = document.getElementById('scoreGrid');
                scoreGrid.innerHTML = `
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.narrative_score}/10</div>
                        <div class="score-label">ナラティブ維持率</div>
                        <small>${geminiAnalysis.narrative_reason}</small>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.hook_score}/10</div>
                        <div class="score-label">フックの効力</div>
                        <small>${geminiAnalysis.hook_reason}</small>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.engagement_score}/10</div>
                        <div class="score-label">エンゲージメント</div>
                        <small>${geminiAnalysis.engagement_reason}</small>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.tech_score}/10</div>
                        <div class="score-label">技術品質</div>
                        <small>${geminiAnalysis.tech_reason}</small>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.vvp_score}/100</div>
                        <div class="score-label">VVPスコア</div>
                        <small>総合評価</small>
                    </div>
                `;
            }

            // Golden Clip
            if (geminiAnalysis && geminiAnalysis.golden_clip) {
                document.getElementById('goldenClip').innerHTML = `
                    <p><strong>時間:</strong> ${geminiAnalysis.golden_clip.time}</p>
                    <p><strong>理由:</strong> ${geminiAnalysis.golden_clip.reason}</p>
                `;
            }

            // 切り抜きポイント分析
            const clipAnalysis = data.clip_analysis;
            if (clipAnalysis) {
                const clipPoints = clipAnalysis.top_clip_points || [];
                const clipHtml = clipPoints.map((point, index) => `
                    <div class="clip-point-item">
                        <div class="clip-time">${point.time}</div>
                        <p><strong>理由:</strong> ${point.reason}</p>
                        <p><strong>コメント数:</strong> ${point.comment_count}件</p>
                        <p><strong>適性:</strong> ${point.clip_suitability}</p>
                    </div>
                `).join('');
                
                document.getElementById('clipAnalysis').innerHTML = `
                    <div class="clip-points-grid">
                        ${clipHtml}
                    </div>
                    <div class="timestamp-comments">
                        <h4>タイムスタンプ付きコメント例:</h4>
                        ${displayTimestampComments(videoInfo?.comments || [])}
                    </div>
                `;
            }

            // 感情分析
            const emotionAnalysis = data.emotion_analysis;
            if (emotionAnalysis) {
                const distribution = emotionAnalysis.satisfaction_distribution || {};
                const emotionHtml = `
                    <div class="emotion-chart">
                        <div>
                            <div class="emotion-bar" style="height: ${distribution.positive * 100}%">
                                ${Math.round(distribution.positive * 100)}%
                            </div>
                            <div class="emotion-label">ポジティブ</div>
                        </div>
                        <div>
                            <div class="emotion-bar" style="height: ${distribution.negative * 100}%">
                                ${Math.round(distribution.negative * 100)}%
                            </div>
                            <div class="emotion-label">ネガティブ</div>
                        </div>
                        <div>
                            <div class="emotion-bar" style="height: ${distribution.neutral * 100}%">
                                ${Math.round(distribution.neutral * 100)}%
                            </div>
                            <div class="emotion-label">ニュートラル</div>
                        </div>
                    </div>
                    <p><strong>全体的な感情傾向:</strong> ${emotionAnalysis.overall_sentiment}</p>
                    <p><strong>満足度スコア:</strong> ${emotionAnalysis.satisfaction_score}/10</p>
                    <p><strong>主要な感情:</strong> ${(emotionAnalysis.key_emotions || []).join(', ')}</p>
                    <p><strong>分析要約:</strong> ${emotionAnalysis.analysis_summary}</p>
                `;
                
                document.getElementById('emotionAnalysis').innerHTML = emotionHtml;
            }

            // Executive Summary
            if (geminiAnalysis && geminiAnalysis.summary) {
                document.getElementById('executiveSummary').innerHTML = `
                    <p>${geminiAnalysis.summary}</p>
                `;
            }

            // ダウンロード情報
            const downloadResult = data.download_result;
            if (downloadResult && downloadResult.success) {
                document.getElementById('downloadInfo').innerHTML = `
                    <p><strong>ダウンロード成功:</strong> ${downloadResult.video_path}</p>
                    <p><strong>ファイルサイズ:</strong> ${(downloadResult.file_size / 1024 / 1024).toFixed(2)} MB</p>
                    <p><strong>形式:</strong> ${downloadResult.format}</p>
                    ${downloadResult.subtitle_path ? `<p><strong>字幕:</strong> ${downloadResult.subtitle_path}</p>` : ''}
                `;
            } else if (downloadResult) {
                document.getElementById('downloadInfo').innerHTML = `
                    <p><strong>ダウンロード失敗:</strong> ${downloadResult.error}</p>
                `;
            }

            // コンテンツ品質分析
            const contentAnalysis = data.content_analysis;
            if (contentAnalysis) {
                let contentHtml = '';
                
                if (contentAnalysis.success) {
                    const quality = contentAnalysis.content_quality;
                    const patterns = contentAnalysis.speech_patterns;
                    const assessment = contentAnalysis.overall_assessment;
                    
                    if (quality) {
                        contentHtml += `
                            <div class="score-grid">
                                <div class="score-item">
                                    <div class="score-value">${quality.content_score}/10</div>
                                    <div class="score-label">コンテンツ品質</div>
                                </div>
                                <div class="score-item">
                                    <div class="score-value">${quality.speech_clarity}/10</div>
                                    <div class="score-label">発言明確性</div>
                                </div>
                                <div class="score-item">
                                    <div class="score-value">${quality.content_structure}/10</div>
                                    <div class="score-label">コンテンツ構造</div>
                                </div>
                                <div class="score-item">
                                    <div class="score-value">${quality.engagement_factors}/10</div>
                                    <div class="score-label">エンゲージメント要因</div>
                                </div>
                                <div class="score-item">
                                    <div class="score-value">${quality.overall_quality}/10</div>
                                    <div class="score-label">総合品質</div>
                                </div>
                            </div>
                            <div class="analysis-details">
                                <h4>詳細分析</h4>
                                <p><strong>統計情報:</strong> ${quality.analysis}</p>
                                ${quality.statistics ? `
                                    <p><strong>総単語数:</strong> ${quality.statistics.total_words}</p>
                                    <p><strong>総文数:</strong> ${quality.statistics.total_sentences}</p>
                                    <p><strong>平均文長:</strong> ${quality.statistics.average_sentence_length.toFixed(1)}語</p>
                                    <p><strong>発言時間:</strong> ${quality.statistics.speech_duration.toFixed(1)}秒</p>
                                ` : ''}
                            </div>
                        `;
                    }
                    
                    if (patterns) {
                        contentHtml += `
                            <div class="speech-patterns">
                                <h4>発言パターン分析</h4>
                                <p><strong>発言リズム:</strong> ${patterns.speech_rhythm}/10</p>
                                <p><strong>分析:</strong> ${patterns.analysis}</p>
                                ${patterns.key_phrases.length > 0 ? `
                                    <h5>キーフレーズ:</h5>
                                    <ul>
                                        ${patterns.key_phrases.map(phrase => `<li>${phrase}</li>`).join('')}
                                    </ul>
                                ` : ''}
                                ${patterns.speech_patterns.length > 0 ? `
                                    <h5>発言パターン:</h5>
                                    <ul>
                                        ${patterns.speech_patterns.map(pattern => `<li>${pattern}</li>`).join('')}
                                    </ul>
                                ` : ''}
                            </div>
                        `;
                    }
                    
                    if (assessment) {
                        contentHtml += `
                            <div class="overall-assessment">
                                <h4>総合評価</h4>
                                <p><strong>総合スコア:</strong> ${assessment.overall_score}/10</p>
                                ${assessment.strengths.length > 0 ? `
                                    <h5>強み:</h5>
                                    <ul>
                                        ${assessment.strengths.map(strength => `<li>${strength}</li>`).join('')}
                                    </ul>
                                ` : ''}
                                ${assessment.weaknesses.length > 0 ? `
                                    <h5>改善点:</h5>
                                    <ul>
                                        ${assessment.weaknesses.map(weakness => `<li>${weakness}</li>`).join('')}
                                    </ul>
                                ` : ''}
                                ${assessment.recommendations.length > 0 ? `
                                    <h5>推奨事項:</h5>
                                    <ul>
                                        ${assessment.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                    </ul>
                                ` : ''}
                            </div>
                        `;
                    }
                    
                    // 音声文字起こし結果
                    const transcription = contentAnalysis.audio_transcription;
                    if (transcription && transcription.success) {
                        contentHtml += `
                            <div class="transcription-result">
                                <h4>音声文字起こし結果</h4>
                                <p><strong>言語:</strong> ${transcription.language}</p>
                                <p><strong>文字起こしテキスト:</strong></p>
                                <div class="transcription-text">
                                    ${transcription.text.substring(0, 500)}${transcription.text.length > 500 ? '...' : ''}
                                </div>
                            </div>
                        `;
                    }
                } else {
                    contentHtml = `<p><strong>エラー:</strong> ${contentAnalysis.error || 'コンテンツ分析に失敗しました'}</p>`;
                }
                
                document.getElementById('contentAnalysis').innerHTML = contentHtml;
            }

            // コメント分析
            if (videoInfo && videoInfo.comments) {
                const comments = videoInfo.comments.slice(0, 5);
                document.getElementById('commentsAnalysis').innerHTML = `
                    <p><strong>コメント数:</strong> ${videoInfo.comments.length}件</p>
                    <h4>最新コメント:</h4>
                    ${comments.map(comment => `
                        <div style="border-left: 3px solid #667eea; padding-left: 10px; margin: 10px 0;">
                            <p><strong>${comment.author}</strong> (${comment.like_count}👍)</p>
                            <p>${comment.text}</p>
                        </div>
                    `).join('')}
                `;
            }

            // チャンネル情報
            if (videoInfo && videoInfo.channel_info) {
                const channel = videoInfo.channel_info;
                document.getElementById('channelInfo').innerHTML = `
                    <p><strong>チャンネル名:</strong> ${channel.name}</p>
                    <p><strong>登録者数:</strong> ${parseInt(channel.subscriber_count).toLocaleString()}</p>
                    <p><strong>動画数:</strong> ${parseInt(channel.video_count).toLocaleString()}</p>
                    <p><strong>総再生回数:</strong> ${parseInt(channel.view_count).toLocaleString()}</p>
                `;
            }

            showResults();
        }

        // タイムスタンプ付きコメント表示
        function displayTimestampComments(comments) {
            const timestampComments = comments.filter(comment => comment.timestamps && comment.timestamps.length > 0);
            
            if (timestampComments.length === 0) {
                return '<p>タイムスタンプ付きコメントが見つかりませんでした。</p>';
            }
            
            return timestampComments.slice(0, 10).map(comment => `
                <div class="timestamp-comment">
                    <div class="timestamp-time">${comment.timestamps[0].formatted}</div>
                    <p><strong>${comment.author}</strong>: ${comment.text}</p>
                </div>
            `).join('');
        }

        // 状態表示
        function showStatus(message, type) {
            const statusSection = document.getElementById('statusSection');
            statusSection.innerHTML = `
                <div class="status-${type}">
                    <p>${message}</p>
                </div>
            `;
            statusSection.className = `status-section show status-${type}`;
            
            setTimeout(() => {
                statusSection.className = 'status-section';
            }, 5000);
        }

        // ローディング表示
        function showLoading(show) {
            const loading = document.getElementById('loading');
            loading.className = show ? 'loading show' : 'loading';
        }

        // 結果表示
        function showResults() {
            document.getElementById('resultsSection').className = 'results-section show';
        }

        // 結果非表示
        function hideResults() {
            document.getElementById('resultsSection').className = 'results-section';
        }

        // リアルタイム処理状況表示
        function showProcessingVisualization() {
            document.getElementById('processingVisualization').style.display = 'block';
        }

        function hideProcessingVisualization() {
            document.getElementById('processingVisualization').style.display = 'none';
        }

        function resetProcessingState() {
            geminiThoughts = [];
            processingLog = [];
            updateThoughtsDisplay();
            updateLogDisplay();
            resetStepIndicators();
        }

        function updateProcessingVisualization(status) {
            // 現在のステップを更新
            if (status.current_step) {
                document.getElementById('currentStep').textContent = status.current_step;
            }

            // Gemini思考プロセスを更新
            if (status.gemini_thoughts && status.gemini_thoughts.length > geminiThoughts.length) {
                geminiThoughts = status.gemini_thoughts;
                updateThoughtsDisplay();
            }

            // 進捗に基づいてステップインジケーターを更新
            updateStepIndicators(status.progress);

            // ログを更新
            addLogEntry(`進捗: ${status.progress}% - ${status.current_step || '処理中'}`);
        }

        function updateThoughtsDisplay() {
            const container = document.getElementById('thoughtsContainer');
            container.innerHTML = '';
            
            geminiThoughts.forEach((thought, index) => {
                const thoughtElement = document.createElement('div');
                thoughtElement.className = 'thought-item';
                thoughtElement.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span style="margin-right: 10px;">${index + 1}</span>
                        <span>${thought}</span>
                    </div>
                `;
                container.appendChild(thoughtElement);
            });
            
            // 最新の思考プロセスまでスクロール
            container.scrollTop = container.scrollHeight;
        }

        function updateLogDisplay() {
            const container = document.getElementById('logContainer');
            container.innerHTML = '';
            
            processingLog.forEach(log => {
                const logElement = document.createElement('div');
                logElement.className = 'log-entry';
                logElement.innerHTML = `
                    <span class="log-timestamp">${log.timestamp}</span>
                    <span class="log-message">${log.message}</span>
                `;
                container.appendChild(logElement);
            });
            
            // 最新のログまでスクロール
            container.scrollTop = container.scrollHeight;
        }

        function addLogEntry(message) {
            const timestamp = new Date().toLocaleTimeString();
            processingLog.push({ timestamp, message });
            updateLogDisplay();
        }

        function updateStepIndicators(progress) {
            const steps = [
                { id: 'step1', threshold: 20, title: 'YouTube情報取得' },
                { id: 'step2', threshold: 40, title: '動画ダウンロード' },
                { id: 'step3', threshold: 60, title: 'Gemini AI分析' },
                { id: 'step4', threshold: 80, title: '感情分析' },
                { id: 'step5', threshold: 90, title: '切り抜き分析' },
                { id: 'step6', threshold: 100, title: '結果統合' }
            ];

            steps.forEach((step, index) => {
                const stepElement = document.getElementById(step.id);
                const stepText = stepElement.parentElement.querySelector('.step-title');
                
                if (progress >= step.threshold) {
                    if (progress === step.threshold) {
                        // 現在アクティブ
                        stepElement.className = 'step-icon step-active';
                        stepText.textContent = `${step.title} (実行中)`;
                    } else {
                        // 完了
                        stepElement.className = 'step-icon step-completed';
                        stepText.textContent = `${step.title} (完了)`;
                    }
                } else {
                    // 待機中
                    stepElement.className = 'step-icon step-pending';
                    stepText.textContent = step.title;
                }
            });
        }

        function resetStepIndicators() {
            for (let i = 1; i <= 6; i++) {
                const stepElement = document.getElementById(`step${i}`);
                const stepText = stepElement.parentElement.querySelector('.step-title');
                stepElement.className = 'step-icon step-pending';
                stepText.textContent = stepText.textContent.replace(' (実行中)', '').replace(' (完了)', '');
            }
        }
    </script>
</body>
</html> 