<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆYouTubeå‹•ç”»åˆ†æã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .api-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .api-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .status-section {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .status-section.show {
            display: block;
        }

        .status-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .status-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }

        .results-section {
            margin-top: 30px;
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .result-card {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .result-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .score-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .score-label {
            color: #666;
            margin-top: 5px;
        }

        .server-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
        }

        .server-online {
            background: #28a745;
            color: white;
        }

        .server-offline {
            background: #dc3545;
            color: white;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .feature-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .download-section {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .download-link {
            display: inline-block;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
        }

        .download-link:hover {
            background: #218838;
        }

        .clip-points-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .clip-point-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
        }

        .clip-time {
            font-size: 1.2em;
            font-weight: bold;
            color: #856404;
            margin-bottom: 5px;
        }

        .emotion-chart {
            display: flex;
            align-items: end;
            height: 100px;
            gap: 10px;
            margin: 20px 0;
        }

        .emotion-bar {
            flex: 1;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 5px 5px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            min-height: 20px;
        }

        .emotion-label {
            text-align: center;
            margin-top: 5px;
            font-size: 0.9em;
            color: #666;
        }

        .timestamp-comments {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .timestamp-comment {
            border-left: 3px solid #667eea;
            padding-left: 10px;
            margin: 10px 0;
        }

        .timestamp-time {
            font-weight: bold;
            color: #667eea;
        }

        .header-features {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .feature-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .gemini-thoughts {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .thought-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 4px solid #fff;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .current-step {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .processing-visualization {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .step-indicator {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
        }

        .step-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            animation: pulse 2s infinite;
        }

        .step-completed {
            background: #28a745;
            color: white;
        }

        .step-pending {
            background: #e9ecef;
            color: #6c757d;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .step-text {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .step-description {
            font-size: 14px;
            color: #666;
        }

        .real-time-log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .log-timestamp {
            color: #888;
            margin-right: 10px;
        }

        .log-message {
            color: #00ff00;
        }

        .transcription-text {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .analysis-details, .speech-patterns, .overall-assessment {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .analysis-details h4, .speech-patterns h4, .overall-assessment h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .analysis-details h5, .speech-patterns h5, .overall-assessment h5 {
            color: #495057;
            margin: 15px 0 8px 0;
        }

        .analysis-details ul, .speech-patterns ul, .overall-assessment ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .analysis-details li, .speech-patterns li, .overall-assessment li {
            margin: 5px 0;
            color: #495057;
        }

        .api-key-container {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 5px;
        }

        .save-key-btn, .load-key-btn, .clear-key-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-key-btn {
            background: #28a745;
            color: white;
        }

        .save-key-btn:hover {
            background: #218838;
        }

        .load-key-btn {
            background: #007bff;
            color: white;
        }

        .load-key-btn:hover {
            background: #0056b3;
        }

        .clear-key-btn {
            background: #dc3545;
            color: white;
        }

        .clear-key-btn:hover {
            background: #c82333;
        }

        .api-key-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }

        .api-key-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .api-key-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .api-key-status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .header-features {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .feature-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .modern-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid #e9ecef;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .modern-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }

        .modern-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .score-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .score-card:hover::before {
            transform: translateX(100%);
        }

        .score-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .score-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .clip-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .clip-card {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #fdcb6e;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .clip-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

        .clip-time {
            font-size: 1.3em;
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .emotion-visualization {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }

        .emotion-bars {
            display: flex;
            align-items: end;
            height: 120px;
            gap: 15px;
            margin: 20px 0;
        }

        .emotion-bar {
            flex: 1;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            min-height: 20px;
            position: relative;
            overflow: hidden;
        }

        .emotion-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.8s;
        }

        .emotion-bar:hover::after {
            transform: translateX(100%);
        }

        .progress-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .progress-bar-modern {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill-modern {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill-modern::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .floating-action-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-action-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }

        .notification.info {
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
        }
    </style>
</head>
<body>
    <div class="server-status" id="serverStatus">
        ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèªä¸­...
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ¬ AI YouTube Analysis Pro</h1>
            <p>Gemini AIæ­è¼‰ãƒ»çµ±åˆYouTubeå‹•ç”»åˆ†æã‚·ã‚¹ãƒ†ãƒ </p>
            <div class="header-features">
                <span class="feature-tag">ğŸ¤– Gemini AI</span>
                <span class="feature-tag">âœ‚ï¸ åˆ‡ã‚ŠæŠœãåˆ†æ</span>
                <span class="feature-tag">ğŸ’­ æ„Ÿæƒ…åˆ†æ</span>
                <span class="feature-tag">ğŸ“Š VVPã‚¹ã‚³ã‚¢</span>
            </div>
        </div>

        <div class="main-content">
            <div class="api-section">
                <h2>ğŸ”‘ APIã‚­ãƒ¼è¨­å®š</h2>
                <div class="input-group">
                    <label for="youtubeApiKey">YouTube Data API v3 ã‚­ãƒ¼</label>
                    <div class="api-key-container">
                        <input type="password" id="youtubeApiKey" placeholder="YouTube APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                        <button type="button" class="save-key-btn" onclick="saveApiKey('youtube')">ğŸ’¾ ä¿å­˜</button>
                        <button type="button" class="load-key-btn" onclick="loadApiKey('youtube')">ğŸ“‚ èª­ã¿è¾¼ã¿</button>
                        <button type="button" class="clear-key-btn" onclick="clearApiKey('youtube')">ğŸ—‘ï¸ å‰Šé™¤</button>
                    </div>
                </div>
                <div class="input-group">
                    <label for="geminiApiKey">Google Gemini API ã‚­ãƒ¼</label>
                    <div class="api-key-container">
                        <input type="password" id="geminiApiKey" placeholder="Gemini APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                        <button type="button" class="save-key-btn" onclick="saveApiKey('gemini')">ğŸ’¾ ä¿å­˜</button>
                        <button type="button" class="load-key-btn" onclick="loadApiKey('gemini')">ğŸ“‚ èª­ã¿è¾¼ã¿</button>
                        <button type="button" class="clear-key-btn" onclick="clearApiKey('gemini')">ğŸ—‘ï¸ å‰Šé™¤</button>
                    </div>
                </div>
                <div class="api-key-status" id="apiKeyStatus"></div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="saveAllApiKeys()">ğŸ’¾ å…¨APIã‚­ãƒ¼ä¿å­˜</button>
                    <button class="btn btn-secondary" onclick="loadAllApiKeys()">ğŸ“‚ å…¨APIã‚­ãƒ¼èª­ã¿è¾¼ã¿</button>
                    <button class="btn btn-secondary" onclick="clearAllApiKeys()">ğŸ—‘ï¸ å…¨APIã‚­ãƒ¼å‰Šé™¤</button>
                </div>
            </div>

            <div class="api-section">
                <h2>ğŸ¬ å‹•ç”»åˆ†æè¨­å®š</h2>
                <div class="input-group">
                    <label for="videoUrl">YouTubeå‹•ç”»URL</label>
                    <input type="url" id="videoUrl" placeholder="https://www.youtube.com/watch?v=...">
                </div>
                <div class="input-group">
                    <label for="analysisType">åˆ†æã‚¿ã‚¤ãƒ—</label>
                    <select id="analysisType">
                        <option value="comprehensive">çµ±åˆåˆ†æï¼ˆæ¨å¥¨ï¼‰</option>
                        <option value="async">éåŒæœŸåˆ†æï¼ˆé•·æ™‚é–“å‹•ç”»ç”¨ï¼‰</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="downloadVideo">å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</label>
                    <select id="downloadVideo">
                        <option value="true">æœ‰åŠ¹</option>
                        <option value="false">ç„¡åŠ¹ï¼ˆæƒ…å ±ã®ã¿ï¼‰</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="outputFormat">å‡ºåŠ›å½¢å¼</label>
                    <select id="outputFormat">
                        <option value="mp4">MP4</option>
                        <option value="mov">MOV</option>
                        <option value="avi">AVI</option>
                        <option value="mkv">MKV</option>
                    </select>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="startAnalysis()">ğŸš€ åˆ†æé–‹å§‹</button>
                <button class="btn btn-secondary" onclick="checkServerStatus()">ğŸ” ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª</button>
                <button class="btn btn-success" onclick="loadTestData()">ğŸ“‹ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>åˆ†æä¸­ã§ã™...ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</p>
            </div>

            <div class="processing-visualization" id="processingVisualization" style="display: none;">
                <h3>ğŸ¤– Gemini AI ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†çŠ¶æ³</h3>
                
                <div class="current-step" id="currentStep">
                    åˆæœŸåŒ–ä¸­...
                </div>

                <div class="gemini-thoughts" id="geminiThoughts">
                    <h4>ğŸ§  Gemini AI æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹</h4>
                    <div id="thoughtsContainer">
                        <!-- æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>

                <div class="real-time-log" id="realTimeLog">
                    <h4>ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°</h4>
                    <div id="logContainer">
                        <!-- ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>

                <div class="step-indicators" id="stepIndicators">
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step1">1</div>
                        <div class="step-text">
                            <div class="step-title">YouTubeæƒ…å ±å–å¾—</div>
                            <div class="step-description">å‹•ç”»ã®è©³ç´°æƒ…å ±ã‚’å–å¾—</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step2">2</div>
                        <div class="step-text">
                            <div class="step-title">å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</div>
                            <div class="step-description">ãƒ•ã‚¡ã‚¤ãƒ«ã¨å­—å¹•ã‚’å–å¾—</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step3">3</div>
                        <div class="step-text">
                            <div class="step-title">Gemini AIåˆ†æ</div>
                            <div class="step-description">è³ªçš„åˆ†æã‚’å®Ÿè¡Œ</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step4">4</div>
                        <div class="step-text">
                            <div class="step-title">æ„Ÿæƒ…åˆ†æ</div>
                            <div class="step-description">ã‚³ãƒ¡ãƒ³ãƒˆã®æ„Ÿæƒ…ã‚’åˆ†æ</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step5">5</div>
                        <div class="step-text">
                            <div class="step-title">åˆ‡ã‚ŠæŠœãåˆ†æ</div>
                            <div class="step-description">åˆ‡ã‚ŠæŠœããƒã‚¤ãƒ³ãƒˆã‚’ç‰¹å®š</div>
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step-icon step-pending" id="step6">6</div>
                        <div class="step-text">
                            <div class="step-title">çµæœçµ±åˆ</div>
                            <div class="step-description">æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆ</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="status-section" id="statusSection"></div>

            <div class="results-section" id="resultsSection">
                <h2>ğŸ“Š åˆ†æçµæœ</h2>
                
                <div class="result-card">
                    <h3>ğŸ¬ å‹•ç”»æƒ…å ±</h3>
                    <div id="videoInfo"></div>
                </div>

                <div class="result-card">
                    <h3>ğŸ¤– AIåˆ†æçµæœ</h3>
                    <div class="score-grid" id="scoreGrid"></div>
                </div>

                <div class="result-card">
                    <h3>ğŸ’ Golden Clip</h3>
                    <div id="goldenClip"></div>
                </div>

                <div class="result-card">
                    <h3>âœ‚ï¸ åˆ‡ã‚ŠæŠœããƒã‚¤ãƒ³ãƒˆåˆ†æ</h3>
                    <div id="clipAnalysis"></div>
                </div>

                <div class="result-card">
                    <h3>ğŸ’­ æ„Ÿæƒ…åˆ†æ</h3>
                    <div id="emotionAnalysis"></div>
                </div>

                <div class="result-card">
                    <h3>ğŸ“‹ Executive Summary</h3>
                    <div id="executiveSummary"></div>
                </div>

                <div class="result-card">
                    <h3>ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æƒ…å ±</h3>
                    <div id="downloadInfo"></div>
                </div>

                <div class="result-card">
                    <h3>ğŸµ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å“è³ªåˆ†æ</h3>
                    <div id="contentAnalysis"></div>
                </div>

                <div class="result-card">
                    <h3>ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆåˆ†æ</h3>
                    <div id="commentsAnalysis"></div>
                </div>

                <div class="result-card">
                    <h3>ğŸ“ˆ ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±</h3>
                    <div id="channelInfo"></div>
                </div>
            </div>

            <div class="feature-list">
                <div class="feature-item">
                    <div class="feature-icon">ğŸ¬</div>
                    <h3>å‹•ç”»å–å¾—</h3>
                    <p>YouTube Data API v3ã«ã‚ˆã‚‹è©³ç´°æƒ…å ±å–å¾—</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">â¬‡ï¸</div>
                    <h3>å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h3>
                    <p>yt-dlpã«ã‚ˆã‚‹é«˜å“è³ªå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ¤–</div>
                    <h3>AIåˆ†æ</h3>
                    <p>Gemini AIã«ã‚ˆã‚‹è³ªçš„åˆ†æã¨è©•ä¾¡</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">âœ‚ï¸</div>
                    <h3>åˆ‡ã‚ŠæŠœãåˆ†æ</h3>
                    <p>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã‚³ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹åˆ‡ã‚ŠæŠœããƒã‚¤ãƒ³ãƒˆç‰¹å®š</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ’­</div>
                    <h3>æ„Ÿæƒ…åˆ†æ</h3>
                    <p>ã‚³ãƒ¡ãƒ³ãƒˆã®æ„Ÿæƒ…å‚¾å‘ã¨æº€è¶³åº¦åˆ†æ</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ“Š</div>
                    <h3>VVPã‚¹ã‚³ã‚¢</h3>
                    <p>å‹•ç”»ä¾¡å€¤è©•ä¾¡ã‚¹ã‚³ã‚¢ï¼ˆ100ç‚¹æº€ç‚¹ï¼‰</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';
        let currentTaskId = null;
        let statusCheckInterval = null;
        let geminiThoughts = [];
        let processingLog = [];

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadApiKeys();
            checkServerStatus();
            setInterval(checkServerStatus, 30000); // 30ç§’ã”ã¨ã«ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª
        });

        // APIã‚­ãƒ¼ã®ä¿å­˜
        function saveApiKeys() {
            const youtubeKey = document.getElementById('youtubeApiKey').value;
            const geminiKey = document.getElementById('geminiApiKey').value;
            
            localStorage.setItem('youtubeApiKey', youtubeKey);
            localStorage.setItem('geminiApiKey', geminiKey);
            
            showStatus('APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
        }

        // APIã‚­ãƒ¼ã®èª­ã¿è¾¼ã¿
        function loadApiKeys() {
            const youtubeKey = localStorage.getItem('youtubeApiKey');
            const geminiKey = localStorage.getItem('geminiApiKey');
            
            if (youtubeKey) document.getElementById('youtubeApiKey').value = youtubeKey;
            if (geminiKey) document.getElementById('geminiApiKey').value = geminiKey;
        }

        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        function loadTestData() {
            document.getElementById('youtubeApiKey').value = 'AIzaSyAs5sjHDdfbe8LZPUULNF2QrzAp-cD8lbg';
            document.getElementById('geminiApiKey').value = 'AIzaSyDosn3ybHfEAV66TsG1fVlTfNQ-itHSFAI';
            document.getElementById('videoUrl').value = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
            showStatus('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ', 'success');
        }

        // ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    timeout: 5000
                });
                
                const data = await response.json();
                
                const statusElement = document.getElementById('serverStatus');
                if (response.ok) {
                    statusElement.textContent = `ğŸŸ¢ ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ (v${data.version})`;
                    statusElement.className = 'server-status server-online';
                } else {
                    throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${response.status}`);
                }
            } catch (error) {
                console.error('ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                const statusElement = document.getElementById('serverStatus');
                statusElement.textContent = 'ğŸ”´ ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ•ãƒ©ã‚¤ãƒ³';
                statusElement.className = 'server-status server-offline';
                
                // ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’è¡¨ç¤º
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showStatus('ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'error');
                }
            }
        }

        // åˆ†æé–‹å§‹
        async function startAnalysis() {
            const url = document.getElementById('videoUrl').value;
            const youtubeKey = document.getElementById('youtubeApiKey').value;
            const geminiKey = document.getElementById('geminiApiKey').value;
            const analysisType = document.getElementById('analysisType').value;
            const downloadVideo = document.getElementById('downloadVideo').value === 'true';
            const outputFormat = document.getElementById('outputFormat').value;

            if (!url || !youtubeKey || !geminiKey) {
                showStatus('URLã¨APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            if (!url.includes('youtube.com') && !url.includes('youtu.be')) {
                showStatus('æœ‰åŠ¹ãªYouTube URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            showLoading(true);
            hideResults();

            const requestData = {
                url: url,
                youtube_api_key: youtubeKey,
                gemini_api_key: geminiKey,
                download_video: downloadVideo,
                output_format: outputFormat
            };

            try {
                if (analysisType === 'async') {
                    await startAsyncAnalysis(requestData);
                } else {
                    await startSyncAnalysis(requestData);
                }
            } catch (error) {
                showStatus(`åˆ†æã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                showLoading(false);
            }
        }

        // åŒæœŸåˆ†æ
        async function startSyncAnalysis(requestData) {
            try {
                const response = await fetch(`${API_BASE_URL}/analyze-video`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                
                if (result.success) {
                    displayResults(result.data);
                    showStatus(`åˆ†æå®Œäº†ï¼å‡¦ç†æ™‚é–“: ${result.processing_time.toFixed(2)}ç§’`, 'success');
                } else {
                    showStatus(`åˆ†æå¤±æ•—: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
                } else if (error.message.includes('404')) {
                    throw new Error(`APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
                } else {
                    throw new Error(`APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            } finally {
                showLoading(false);
            }
        }

        // éåŒæœŸåˆ†æ
        async function startAsyncAnalysis(requestData) {
            try {
                const response = await fetch(`${API_BASE_URL}/analyze-video-async`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                
                if (result.task_id) {
                    currentTaskId = result.task_id;
                    showStatus('éåŒæœŸåˆ†æã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚é€²æ—ã‚’ç¢ºèªä¸­...', 'info');
                    
                    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†çŠ¶æ³è¡¨ç¤ºã‚’é–‹å§‹
                    showProcessingVisualization();
                    resetProcessingState();
                    
                    startStatusCheck();
                } else {
                    throw new Error('ã‚¿ã‚¹ã‚¯IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');
                }
            } catch (error) {
                throw new Error(`éåŒæœŸåˆ†æé–‹å§‹ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // çŠ¶æ…‹ç¢ºèª
        function startStatusCheck() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
            }
            
            statusCheckInterval = setInterval(async () => {
                if (!currentTaskId) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/analysis-status/${currentTaskId}`);
                    const status = await response.json();
                    
                    updateProgress(status.progress);
                    updateProcessingVisualization(status);
                    
                    if (status.status === 'completed') {
                        clearInterval(statusCheckInterval);
                        displayResults(status.result);
                        showStatus('éåŒæœŸåˆ†æå®Œäº†ï¼', 'success');
                        showLoading(false);
                        hideProcessingVisualization();
                        currentTaskId = null;
                    } else if (status.status === 'error') {
                        clearInterval(statusCheckInterval);
                        showStatus(`éåŒæœŸåˆ†æã‚¨ãƒ©ãƒ¼: ${status.error}`, 'error');
                        showLoading(false);
                        hideProcessingVisualization();
                        currentTaskId = null;
                    }
                } catch (error) {
                    console.error('çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                }
            }, 2000); // 2ç§’ã”ã¨ã«ç¢ºèª
        }

        // é€²æ—æ›´æ–°
        function updateProgress(progress) {
            const progressBar = document.querySelector('.progress-fill');
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
            }
        }

        // çµæœè¡¨ç¤º
        function displayResults(data) {
            if (!data) return;

            // å‹•ç”»æƒ…å ±
            const videoInfo = data.video_info;
            if (videoInfo) {
                document.getElementById('videoInfo').innerHTML = `
                    <p><strong>ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${videoInfo.title}</p>
                    <p><strong>ãƒãƒ£ãƒ³ãƒãƒ«:</strong> ${videoInfo.channel_title}</p>
                    <p><strong>å†ç”Ÿå›æ•°:</strong> ${videoInfo.view_count.toLocaleString()}</p>
                    <p><strong>é«˜è©•ä¾¡æ•°:</strong> ${videoInfo.like_count.toLocaleString()}</p>
                    <p><strong>ã‚³ãƒ¡ãƒ³ãƒˆæ•°:</strong> ${videoInfo.comment_count.toLocaleString()}</p>
                    <p><strong>å…¬é–‹æ—¥:</strong> ${new Date(videoInfo.published_at).toLocaleDateString('ja-JP')}</p>
                `;
            }

            // AIåˆ†æçµæœ
            const geminiAnalysis = data.gemini_analysis;
            if (geminiAnalysis) {
                const scoreGrid = document.getElementById('scoreGrid');
                scoreGrid.innerHTML = `
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.narrative_score}/10</div>
                        <div class="score-label">ãƒŠãƒ©ãƒ†ã‚£ãƒ–ç¶­æŒç‡</div>
                        <small>${geminiAnalysis.narrative_reason}</small>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.hook_score}/10</div>
                        <div class="score-label">ãƒ•ãƒƒã‚¯ã®åŠ¹åŠ›</div>
                        <small>${geminiAnalysis.hook_reason}</small>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.engagement_score}/10</div>
                        <div class="score-label">ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ</div>
                        <small>${geminiAnalysis.engagement_reason}</small>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.tech_score}/10</div>
                        <div class="score-label">æŠ€è¡“å“è³ª</div>
                        <small>${geminiAnalysis.tech_reason}</small>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${geminiAnalysis.vvp_score}/100</div>
                        <div class="score-label">VVPã‚¹ã‚³ã‚¢</div>
                        <small>ç·åˆè©•ä¾¡</small>
                    </div>
                `;
            }

            // Golden Clip
            if (geminiAnalysis && geminiAnalysis.golden_clip) {
                document.getElementById('goldenClip').innerHTML = `
                    <p><strong>æ™‚é–“:</strong> ${geminiAnalysis.golden_clip.time}</p>
                    <p><strong>ç†ç”±:</strong> ${geminiAnalysis.golden_clip.reason}</p>
                `;
            }

            // åˆ‡ã‚ŠæŠœããƒã‚¤ãƒ³ãƒˆåˆ†æ
            const clipAnalysis = data.clip_analysis;
            if (clipAnalysis) {
                const clipPoints = clipAnalysis.top_clip_points || [];
                const clipHtml = clipPoints.map((point, index) => `
                    <div class="clip-point-item">
                        <div class="clip-time">${point.time}</div>
                        <p><strong>ç†ç”±:</strong> ${point.reason}</p>
                        <p><strong>ã‚³ãƒ¡ãƒ³ãƒˆæ•°:</strong> ${point.comment_count}ä»¶</p>
                        <p><strong>é©æ€§:</strong> ${point.clip_suitability}</p>
                    </div>
                `).join('');
                
                document.getElementById('clipAnalysis').innerHTML = `
                    <div class="clip-points-grid">
                        ${clipHtml}
                    </div>
                    <div class="timestamp-comments">
                        <h4>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã‚³ãƒ¡ãƒ³ãƒˆä¾‹:</h4>
                        ${displayTimestampComments(videoInfo?.comments || [])}
                    </div>
                `;
            }

            // æ„Ÿæƒ…åˆ†æ
            const emotionAnalysis = data.emotion_analysis;
            if (emotionAnalysis) {
                const distribution = emotionAnalysis.satisfaction_distribution || {};
                const emotionHtml = `
                    <div class="emotion-chart">
                        <div>
                            <div class="emotion-bar" style="height: ${distribution.positive * 100}%">
                                ${Math.round(distribution.positive * 100)}%
                            </div>
                            <div class="emotion-label">ãƒã‚¸ãƒ†ã‚£ãƒ–</div>
                        </div>
                        <div>
                            <div class="emotion-bar" style="height: ${distribution.negative * 100}%">
                                ${Math.round(distribution.negative * 100)}%
                            </div>
                            <div class="emotion-label">ãƒã‚¬ãƒ†ã‚£ãƒ–</div>
                        </div>
                        <div>
                            <div class="emotion-bar" style="height: ${distribution.neutral * 100}%">
                                ${Math.round(distribution.neutral * 100)}%
                            </div>
                            <div class="emotion-label">ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«</div>
                        </div>
                    </div>
                    <p><strong>å…¨ä½“çš„ãªæ„Ÿæƒ…å‚¾å‘:</strong> ${emotionAnalysis.overall_sentiment}</p>
                    <p><strong>æº€è¶³åº¦ã‚¹ã‚³ã‚¢:</strong> ${emotionAnalysis.satisfaction_score}/10</p>
                    <p><strong>ä¸»è¦ãªæ„Ÿæƒ…:</strong> ${(emotionAnalysis.key_emotions || []).join(', ')}</p>
                    <p><strong>åˆ†æè¦ç´„:</strong> ${emotionAnalysis.analysis_summary}</p>
                `;
                
                document.getElementById('emotionAnalysis').innerHTML = emotionHtml;
            }

            // Executive Summary
            if (geminiAnalysis && geminiAnalysis.summary) {
                document.getElementById('executiveSummary').innerHTML = `
                    <p>${geminiAnalysis.summary}</p>
                `;
            }

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æƒ…å ±
            const downloadResult = data.download_result;
            if (downloadResult && downloadResult.success) {
                document.getElementById('downloadInfo').innerHTML = `
                    <p><strong>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æˆåŠŸ:</strong> ${downloadResult.video_path}</p>
                    <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:</strong> ${(downloadResult.file_size / 1024 / 1024).toFixed(2)} MB</p>
                    <p><strong>å½¢å¼:</strong> ${downloadResult.format}</p>
                    ${downloadResult.subtitle_path ? `<p><strong>å­—å¹•:</strong> ${downloadResult.subtitle_path}</p>` : ''}
                `;
            } else if (downloadResult) {
                document.getElementById('downloadInfo').innerHTML = `
                    <p><strong>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—:</strong> ${downloadResult.error}</p>
                `;
            }

            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å“è³ªåˆ†æ
            const contentAnalysis = data.content_analysis;
            if (contentAnalysis) {
                let contentHtml = '';
                
                if (contentAnalysis.success) {
                    const quality = contentAnalysis.content_quality;
                    const patterns = contentAnalysis.speech_patterns;
                    const assessment = contentAnalysis.overall_assessment;
                    
                    if (quality) {
                        contentHtml += `
                            <div class="score-grid">
                                <div class="score-item">
                                    <div class="score-value">${quality.content_score}/10</div>
                                    <div class="score-label">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å“è³ª</div>
                                </div>
                                <div class="score-item">
                                    <div class="score-value">${quality.speech_clarity}/10</div>
                                    <div class="score-label">ç™ºè¨€æ˜ç¢ºæ€§</div>
                                </div>
                                <div class="score-item">
                                    <div class="score-value">${quality.content_structure}/10</div>
                                    <div class="score-label">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ§‹é€ </div>
                                </div>
                                <div class="score-item">
                                    <div class="score-value">${quality.engagement_factors}/10</div>
                                    <div class="score-label">ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆè¦å› </div>
                                </div>
                                <div class="score-item">
                                    <div class="score-value">${quality.overall_quality}/10</div>
                                    <div class="score-label">ç·åˆå“è³ª</div>
                                </div>
                            </div>
                            <div class="analysis-details">
                                <h4>è©³ç´°åˆ†æ</h4>
                                <p><strong>çµ±è¨ˆæƒ…å ±:</strong> ${quality.analysis}</p>
                                ${quality.statistics ? `
                                    <p><strong>ç·å˜èªæ•°:</strong> ${quality.statistics.total_words}</p>
                                    <p><strong>ç·æ–‡æ•°:</strong> ${quality.statistics.total_sentences}</p>
                                    <p><strong>å¹³å‡æ–‡é•·:</strong> ${quality.statistics.average_sentence_length.toFixed(1)}èª</p>
                                    <p><strong>ç™ºè¨€æ™‚é–“:</strong> ${quality.statistics.speech_duration.toFixed(1)}ç§’</p>
                                ` : ''}
                            </div>
                        `;
                    }
                    
                    if (patterns) {
                        contentHtml += `
                            <div class="speech-patterns">
                                <h4>ç™ºè¨€ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ</h4>
                                <p><strong>ç™ºè¨€ãƒªã‚ºãƒ :</strong> ${patterns.speech_rhythm}/10</p>
                                <p><strong>åˆ†æ:</strong> ${patterns.analysis}</p>
                                ${patterns.key_phrases.length > 0 ? `
                                    <h5>ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ã‚º:</h5>
                                    <ul>
                                        ${patterns.key_phrases.map(phrase => `<li>${phrase}</li>`).join('')}
                                    </ul>
                                ` : ''}
                                ${patterns.speech_patterns.length > 0 ? `
                                    <h5>ç™ºè¨€ãƒ‘ã‚¿ãƒ¼ãƒ³:</h5>
                                    <ul>
                                        ${patterns.speech_patterns.map(pattern => `<li>${pattern}</li>`).join('')}
                                    </ul>
                                ` : ''}
                            </div>
                        `;
                    }
                    
                    if (assessment) {
                        contentHtml += `
                            <div class="overall-assessment">
                                <h4>ç·åˆè©•ä¾¡</h4>
                                <p><strong>ç·åˆã‚¹ã‚³ã‚¢:</strong> ${assessment.overall_score}/10</p>
                                ${assessment.strengths.length > 0 ? `
                                    <h5>å¼·ã¿:</h5>
                                    <ul>
                                        ${assessment.strengths.map(strength => `<li>${strength}</li>`).join('')}
                                    </ul>
                                ` : ''}
                                ${assessment.weaknesses.length > 0 ? `
                                    <h5>æ”¹å–„ç‚¹:</h5>
                                    <ul>
                                        ${assessment.weaknesses.map(weakness => `<li>${weakness}</li>`).join('')}
                                    </ul>
                                ` : ''}
                                ${assessment.recommendations.length > 0 ? `
                                    <h5>æ¨å¥¨äº‹é …:</h5>
                                    <ul>
                                        ${assessment.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                    </ul>
                                ` : ''}
                            </div>
                        `;
                    }
                    
                    // éŸ³å£°æ–‡å­—èµ·ã“ã—çµæœ
                    const transcription = contentAnalysis.audio_transcription;
                    if (transcription && transcription.success) {
                        contentHtml += `
                            <div class="transcription-result">
                                <h4>éŸ³å£°æ–‡å­—èµ·ã“ã—çµæœ</h4>
                                <p><strong>è¨€èª:</strong> ${transcription.language}</p>
                                <p><strong>æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆ:</strong></p>
                                <div class="transcription-text">
                                    ${transcription.text.substring(0, 500)}${transcription.text.length > 500 ? '...' : ''}
                                </div>
                            </div>
                        `;
                    }
                } else {
                    contentHtml = `<p><strong>ã‚¨ãƒ©ãƒ¼:</strong> ${contentAnalysis.error || 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ'}</p>`;
                }
                
                document.getElementById('contentAnalysis').innerHTML = contentHtml;
            }

            // ã‚³ãƒ¡ãƒ³ãƒˆåˆ†æ
            if (videoInfo && videoInfo.comments) {
                const comments = videoInfo.comments.slice(0, 5);
                document.getElementById('commentsAnalysis').innerHTML = `
                    <p><strong>ã‚³ãƒ¡ãƒ³ãƒˆæ•°:</strong> ${videoInfo.comments.length}ä»¶</p>
                    <h4>æœ€æ–°ã‚³ãƒ¡ãƒ³ãƒˆ:</h4>
                    ${comments.map(comment => `
                        <div style="border-left: 3px solid #667eea; padding-left: 10px; margin: 10px 0;">
                            <p><strong>${comment.author}</strong> (${comment.like_count}ğŸ‘)</p>
                            <p>${comment.text}</p>
                        </div>
                    `).join('')}
                `;
            }

            // ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±
            if (videoInfo && videoInfo.channel_info) {
                const channel = videoInfo.channel_info;
                document.getElementById('channelInfo').innerHTML = `
                    <p><strong>ãƒãƒ£ãƒ³ãƒãƒ«å:</strong> ${channel.name}</p>
                    <p><strong>ç™»éŒ²è€…æ•°:</strong> ${parseInt(channel.subscriber_count).toLocaleString()}</p>
                    <p><strong>å‹•ç”»æ•°:</strong> ${parseInt(channel.video_count).toLocaleString()}</p>
                    <p><strong>ç·å†ç”Ÿå›æ•°:</strong> ${parseInt(channel.view_count).toLocaleString()}</p>
                `;
            }

            showResults();
        }

        // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º
        function displayTimestampComments(comments) {
            const timestampComments = comments.filter(comment => comment.timestamps && comment.timestamps.length > 0);
            
            if (timestampComments.length === 0) {
                return '<p>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
            }
            
            return timestampComments.slice(0, 10).map(comment => `
                <div class="timestamp-comment">
                    <div class="timestamp-time">${comment.timestamps[0].formatted}</div>
                    <p><strong>${comment.author}</strong>: ${comment.text}</p>
                </div>
            `).join('');
        }

        // çŠ¶æ…‹è¡¨ç¤º
        function showStatus(message, type) {
            const statusSection = document.getElementById('statusSection');
            statusSection.innerHTML = `
                <div class="status-${type}">
                    <p>${message}</p>
                </div>
            `;
            statusSection.className = `status-section show status-${type}`;
            
            setTimeout(() => {
                statusSection.className = 'status-section';
            }, 5000);
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        function showLoading(show) {
            const loading = document.getElementById('loading');
            loading.className = show ? 'loading show' : 'loading';
        }

        // çµæœè¡¨ç¤º
        function showResults() {
            document.getElementById('resultsSection').className = 'results-section show';
        }

        // çµæœéè¡¨ç¤º
        function hideResults() {
            document.getElementById('resultsSection').className = 'results-section';
        }

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†çŠ¶æ³è¡¨ç¤º
        function showProcessingVisualization() {
            document.getElementById('processingVisualization').style.display = 'block';
        }

        function hideProcessingVisualization() {
            document.getElementById('processingVisualization').style.display = 'none';
        }

        function resetProcessingState() {
            geminiThoughts = [];
            processingLog = [];
            updateThoughtsDisplay();
            updateLogDisplay();
            resetStepIndicators();
        }

        function updateProcessingVisualization(status) {
            // ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’æ›´æ–°
            if (status.current_step) {
                document.getElementById('currentStep').textContent = status.current_step;
            }

            // Geminiæ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã‚’æ›´æ–°
            if (status.gemini_thoughts && status.gemini_thoughts.length > geminiThoughts.length) {
                geminiThoughts = status.gemini_thoughts;
                updateThoughtsDisplay();
            }

            // é€²æ—ã«åŸºã¥ã„ã¦ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°
            updateStepIndicators(status.progress);

            // ãƒ­ã‚°ã‚’æ›´æ–°
            addLogEntry(`é€²æ—: ${status.progress}% - ${status.current_step || 'å‡¦ç†ä¸­'}`);
        }

        function updateThoughtsDisplay() {
            const container = document.getElementById('thoughtsContainer');
            container.innerHTML = '';
            
            geminiThoughts.forEach((thought, index) => {
                const thoughtElement = document.createElement('div');
                thoughtElement.className = 'thought-item';
                thoughtElement.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span style="margin-right: 10px;">${index + 1}</span>
                        <span>${thought}</span>
                    </div>
                `;
                container.appendChild(thoughtElement);
            });
            
            // æœ€æ–°ã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            container.scrollTop = container.scrollHeight;
        }

        function updateLogDisplay() {
            const container = document.getElementById('logContainer');
            container.innerHTML = '';
            
            processingLog.forEach(log => {
                const logElement = document.createElement('div');
                logElement.className = 'log-entry';
                logElement.innerHTML = `
                    <span class="log-timestamp">${log.timestamp}</span>
                    <span class="log-message">${log.message}</span>
                `;
                container.appendChild(logElement);
            });
            
            // æœ€æ–°ã®ãƒ­ã‚°ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            container.scrollTop = container.scrollHeight;
        }

        function addLogEntry(message) {
            const timestamp = new Date().toLocaleTimeString();
            processingLog.push({ timestamp, message });
            updateLogDisplay();
        }

        function updateStepIndicators(progress) {
            const steps = [
                { id: 'step1', threshold: 20, title: 'YouTubeæƒ…å ±å–å¾—' },
                { id: 'step2', threshold: 40, title: 'å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰' },
                { id: 'step3', threshold: 60, title: 'Gemini AIåˆ†æ' },
                { id: 'step4', threshold: 80, title: 'æ„Ÿæƒ…åˆ†æ' },
                { id: 'step5', threshold: 90, title: 'åˆ‡ã‚ŠæŠœãåˆ†æ' },
                { id: 'step6', threshold: 100, title: 'çµæœçµ±åˆ' }
            ];

            steps.forEach((step, index) => {
                const stepElement = document.getElementById(step.id);
                const stepText = stepElement.parentElement.querySelector('.step-title');
                
                if (progress >= step.threshold) {
                    if (progress === step.threshold) {
                        // ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
                        stepElement.className = 'step-icon step-active';
                        stepText.textContent = `${step.title} (å®Ÿè¡Œä¸­)`;
                    } else {
                        // å®Œäº†
                        stepElement.className = 'step-icon step-completed';
                        stepText.textContent = `${step.title} (å®Œäº†)`;
                    }
                } else {
                    // å¾…æ©Ÿä¸­
                    stepElement.className = 'step-icon step-pending';
                    stepText.textContent = step.title;
                }
            });
        }

        function resetStepIndicators() {
            for (let i = 1; i <= 6; i++) {
                const stepElement = document.getElementById(`step${i}`);
                const stepText = stepElement.parentElement.querySelector('.step-title');
                stepElement.className = 'step-icon step-pending';
                stepText.textContent = stepText.textContent.replace(' (å®Ÿè¡Œä¸­)', '').replace(' (å®Œäº†)', '');
            }
        }
    </script>
</body>
</html> 